@using Microsoft.FSharp.Core
@using CardOverflow.Entity
@using CardOverflow.Debug
@using CardOverflow.Pure
@using CardOverflow.Server.Pages.Concept
@using CardOverflow.Api
@using Microsoft.AspNetCore.Components
@using Microsoft.AspNetCore.Identity
@using CardOverflow.Sanitation
@using ThoughtDesign.WebLibrary
@using Microsoft.FSharp.Collections
@inject DbExecutor DbExecutor
@inject NavigationManager NavigationManager
@inject IToastService ToastService

<div class="row">
  <div class="col-auto mt-2">
    Move
    <a href="my/concept?revision=@Mine.RevisionId&index=@Mine.Index" class="mx-1">
      <HoverPreview Padding="0">
        <ResizingIframe Revision=@((Mine.RevisionId, Mine.Index)) Back />
      </HoverPreview>
      @Mine.RevisionId with index @Mine.Index
    </a>
    to another deck
  </div>
  <div class="col">
    <DeckSelector SelectedIds=@(new List<Guid> { Mine.DeckId })
                  DecksSelected=@(async newDeckIds => {
                                    if (!newDeckIds.Contains(Mine.DeckId)) {
                                      await DbExecutor.QueryAsync(db => SanitizeDeckRepository.switchByIds(db, Guid.Empty, Guid.Empty, Mine.RevisionId, Mine.Index))
                                        .Match(ToastService, _ => ToastService.ShowInfo("Deck saved!"));
                                      await Remove.InvokeAsync(null);
                                    }
                                  }) />
  </div>
</div>

@code {
  [Parameter] public ConceptRevisionIndex Mine { get; set; }
  [Parameter] public EventCallback Remove { get; set; }

}
